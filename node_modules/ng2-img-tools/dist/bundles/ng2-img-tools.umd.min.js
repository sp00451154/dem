!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs/Subject"),require("ng2-img-max")):"function"==typeof define&&define.amd?define(["exports","@angular/core","rxjs/Subject","ng2-img-max"],t):t(e["ng2-img-tools"]={},e.ng.core,e.Subject,e.ng2ImgMax)}(this,function(e,t,r,n){"use strict";var i=function(){function e(e){this.ng2ImgMaxService=e}return e.prototype.cropImage=function(e,t,n,i,o){var a=this;void 0===i&&(i=0),void 0===o&&(o=0);var c=new r.Subject;if("image/jpeg"!==e.type&&"image/png"!==e.type)return setTimeout(function(){c.error({croppedFile:e,reason:"File provided is neither of type jpg nor of type png.",error:"INVALID_EXTENSION"})},0),c.asObservable();var g=document.createElement("canvas"),s=g.getContext("2d"),u=new Image;return u.onload=function(){a.ng2ImgMaxService.getEXIFOrientedImage(u).then(function(r){window.URL.revokeObjectURL(u.src),g.width=t,g.height=n,s.drawImage(r,i,o,t,n,0,0,t,n);var p=s.getImageData(0,0,r.width,r.height),f=!0;("image/jpeg"===e.type||"image/png"===e.type&&!a.isImgUsingAlpha(p))&&(f=!1,(s=g.getContext("2d",{alpha:!1})).drawImage(r,i,o,t,n,0,0,t,n)),g.toBlob(function(t){var r=a.generateResultFile(t,e.name,e.type,(new Date).getTime());c.next(r)},f?"image/png":"image/jpeg")})},u.src=window.URL.createObjectURL(e),c.asObservable()},e.prototype.isImgUsingAlpha=function(e){for(var t=0;t<e.data.length;t+=4)if(255!==e.data[t+3])return!0;return!1},e.prototype.generateResultFile=function(e,t,r,n){var i=new Blob([e],{type:r});return this.blobToFile(i,t,n)},e.prototype.blobToFile=function(e,t,r){var n=e;return n.name=t,n.lastModified=r,n},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:n.Ng2ImgMaxService,decorators:[{type:t.Inject,args:[t.forwardRef(function(){return n.Ng2ImgMaxService})]}]}]},e}(),o=function(){function e(e,t){this.ng2ImgMaxService=e,this.imgCropService=t}return e.prototype.resizeExactFill=function(e,t,n,i){var o=this,a=new r.Subject;if("image/jpeg"!==e.type&&"image/png"!==e.type)return setTimeout(function(){a.error({resizedFile:e,reason:"File provided is neither of type jpg nor of type png.",error:"INVALID_EXTENSION"})},0),a.asObservable();var c=new Image;return c.onload=function(){o.ng2ImgMaxService.getEXIFOrientedImage(c).then(function(r){window.URL.revokeObjectURL(c.src);var g=r.width/r.height,s=t/n,u=1e5,p=1e5;g>s?p=t:g<=s&&(u=n),o.ng2ImgMaxService.resize([e],p,u).subscribe(function(c){var g=0,s=0;if(1e5===p){var f=r.width/(r.height/n);g=(f-t)/2}else if(1e5===u){var m=r.height/(r.width/t);s=(m-n)/2}var d=new Image,v=document.createElement("canvas"),l=v.getContext("2d");d.onload=function(){v.width=t,v.height=n,i&&(l.fillStyle=i,l.fillRect(0,0,t,n)),l.drawImage(d,g,s,t,n,0,0,t,n);var r=l.getImageData(0,0,t,n),c=!0;("image/jpeg"===e.type||"image/png"===e.type&&!o.isImgUsingAlpha(r))&&(c=!1,l=v.getContext("2d",{alpha:!1}),i&&(l.fillStyle=i,l.fillRect(0,0,t,n)),l.drawImage(d,g,s,t,n,0,0,t,n)),v.toBlob(function(t){window.URL.revokeObjectURL(d.src);var r=o.generateResultFile(t,e.name,e.type,(new Date).getTime());a.next(r)},c?"image/png":"image/jpeg")},d.src=window.URL.createObjectURL(c)},function(e){a.error(e)})})},c.src=window.URL.createObjectURL(e),a.asObservable()},e.prototype.resizeExactCrop=function(e,t,n){var i=this,o=new r.Subject;if("image/jpeg"!==e.type&&"image/png"!==e.type)return setTimeout(function(){o.error({resizedFile:e,reason:"File provided is neither of type jpg nor of type png.",error:"INVALID_EXTENSION"})},0),o.asObservable();var a=new Image;return a.onload=function(){i.ng2ImgMaxService.getEXIFOrientedImage(a).then(function(r){window.URL.revokeObjectURL(a.src);var c=r.width/r.height,g=t/n,s=1e5,u=1e5,p=0,f=0;c>g?s=n:c<=g&&(u=t),i.ng2ImgMaxService.resize([e],u,s).subscribe(function(e){if(1e5===u){var a=r.width/(r.height/n);p=(a-t)/2}else if(1e5===s){var c=r.height/(r.width/t);f=(c-n)/2}i.imgCropService.cropImage(e,t,n,p,f).subscribe(function(e){o.next(e)},function(e){o.error(e)})},function(e){o.error(e)})})},a.src=window.URL.createObjectURL(e),o.asObservable()},e.prototype.isImgUsingAlpha=function(e){for(var t=0;t<e.data.length;t+=4)if(255!==e.data[t+3])return!0;return!1},e.prototype.generateResultFile=function(e,t,r,n){var i=new Blob([e],{type:r});return this.blobToFile(i,t,n)},e.prototype.blobToFile=function(e,t,r){var n=e;return n.name=t,n.lastModified=r,n},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:n.Ng2ImgMaxService,decorators:[{type:t.Inject,args:[t.forwardRef(function(){return n.Ng2ImgMaxService})]}]},{type:i,decorators:[{type:t.Inject,args:[t.forwardRef(function(){return i})]}]}]},e}(),a=function(){function e(e,t,r){this.imgResizeExactService=e,this.ng2ImgMaxService=t,this.imgCropService=r}return e.prototype.compress=function(e,t,r,n){return void 0===r&&(r=!1),void 0===n&&(n=!1),this.ng2ImgMaxService.compress(e,t,r,n)},e.prototype.resize=function(e,t,r,n){return void 0===n&&(n=!1),this.ng2ImgMaxService.resize(e,t,r,n)},e.prototype.crop=function(e,t,n,i,o){var a=this;void 0===i&&(i=0),void 0===o&&(o=0);var c=new r.Subject;return e.forEach(function(e){a.cropImage(e,t,n,i,o).subscribe(function(e){c.next(e)},function(e){c.error(e)})}),c.asObservable()},e.prototype.resizeExactCrop=function(e,t,n){var i=this,o=new r.Subject;return e.forEach(function(e){i.resizeExactCropImage(e,t,n).subscribe(function(e){o.next(e)},function(e){o.error(e)})}),o.asObservable()},e.prototype.resizeExactFill=function(e,t,n,i){var o=this,a=new r.Subject;return e.forEach(function(e){o.resizeExactFillImage(e,t,n,i).subscribe(function(e){a.next(e)},function(e){a.error(e)})}),a.asObservable()},e.prototype.resizeExactFillImage=function(e,t,r,n){return this.imgResizeExactService.resizeExactFill(e,t,r,n)},e.prototype.resizeExactCropImage=function(e,t,r){return this.imgResizeExactService.resizeExactCrop(e,t,r)},e.prototype.cropImage=function(e,t,r,n,i){return void 0===n&&(n=0),void 0===i&&(i=0),this.imgCropService.cropImage(e,t,r,n,i)},e.prototype.compressImage=function(e,t,r,n){return void 0===r&&(r=!1),void 0===n&&(n=!1),this.ng2ImgMaxService.compressImage(e,t,r,n)},e.prototype.resizeImage=function(e,t,r,n){return void 0===n&&(n=!1),this.ng2ImgMaxService.resizeImage(e,t,r,n)},e.prototype.getEXIFOrientedImage=function(e){return this.ng2ImgMaxService.getEXIFOrientedImage(e)},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:o,decorators:[{type:t.Inject,args:[t.forwardRef(function(){return o})]}]},{type:n.Ng2ImgMaxService,decorators:[{type:t.Inject,args:[t.forwardRef(function(){return n.Ng2ImgMaxService})]}]},{type:i,decorators:[{type:t.Inject,args:[t.forwardRef(function(){return i})]}]}]},e}(),c=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[n.Ng2ImgMaxModule],providers:[{provide:o,useClass:o},{provide:i,useClass:i},{provide:a,useClass:a},{provide:n.Ng2ImgMaxService,useClass:n.Ng2ImgMaxService}]}]}],e.ctorParameters=function(){return[]},e}();e.Ng2ImgToolsService=a,e.Ng2ImgToolsModule=c,e.ImgCropService=i,e.ImgResizeExactService=o,Object.defineProperty(e,"__esModule",{value:!0})});