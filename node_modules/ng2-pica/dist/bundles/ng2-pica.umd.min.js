!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs/Subject"),require("pica/dist/pica"),require("exif-js/exif")):"function"==typeof define&&define.amd?define(["exports","@angular/core","rxjs/Subject","pica/dist/pica","exif-js/exif"],t):t(e["ng2-pica"]=e["ng2-pica"]||{},e.ng.core,e.rxjs_Subject,e.pica,e.EXIF)}(this,function(e,t,n,i,r){"use strict";i="default"in i?i.default:i;var o=function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},a=function(){function e(){}return e.prototype.getOrientedImage=function(e){return new Promise(function(t,n){var i;r.getData(e,function(){var n=r.getTag(e,"Orientation");if(1!=n){var o=document.createElement("canvas"),a=o.getContext("2d"),c=e.width,f=e.height,u=0,s=0,d=0;switch(n){case 3:case 4:u=-e.width,s=-e.height,d=180;break;case 5:case 6:c=e.height,f=e.width,s=-e.height,d=90;break;case 7:case 8:c=e.height,f=e.width,u=-e.width,d=270}o.width=c,o.height=f,[2,4,5,7].indexOf(n)>-1&&(a.translate(c,0),a.scale(-1,1)),a.rotate(d*Math.PI/180),a.drawImage(e,u,s),i=document.createElement("img"),i.width=c,i.height=f,i.addEventListener("load",function(){t(i)}),i.src=o.toDataURL("image/png")}else t(e)})})},e=o([t.Injectable()],e)}(),c=function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},f=function(e,t){return function(n,i){t(n,i,e)}},u=function(){function e(e){this.imageExifService=e}return e.prototype.resize=function(e,t,i,r){void 0===r&&(r=!1);for(var o=new n.Subject,a=0;a<e.length;a++)this.resizeFile(e[a],t,i,r).then(function(e){o.next(e)}).catch(function(e){o.error(e)});return o.asObservable()},e.prototype.resizeCanvas=function(e,t,n){return new Promise(function(r,o){var a=new i;a&&a.resize||(a=new window.pica),a.resize(e,t,n).then(function(e){r(e)},function(e){o(e)})})},e.prototype.resizeBuffer=function(e){return new Promise(function(t,n){var r=new i;r&&r.resizeBuffer||(r=new window.pica),r.resizeBuffer(e).then(function(e){t(e)},function(e){n(e)})})},e.prototype.resizeFile=function(e,t,n,i){var r=this;return void 0===i&&(i=!1),new Promise(function(o,a){var c=document.createElement("canvas"),f=c.getContext("2d"),u=new Image;u.onload=function(){r.imageExifService.getOrientedImage(u).then(function(s){window.URL.revokeObjectURL(u.src),c.width=s.width,c.height=s.height,f.drawImage(s,0,0);var d=f.getImageData(0,0,s.width,s.height);if(i){var h=Math.min(t/d.width,n/d.height);t=Math.round(d.width*h),n=Math.round(d.height*h)}var l=!0;("image/jpeg"===e.type||"image/png"===e.type&&!r.isImgUsingAlpha(d))&&(l=!1,f=c.getContext("2d",{alpha:!1}),f.drawImage(s,0,0));var g=document.createElement("canvas");g.width=t,g.height=n,r.resizeCanvas(c,g,{alpha:l}).then(function(t){t.toBlob(function(t){var n=r.generateResultFile(t,e.name,e.type,(new Date).getTime());o(n)},e.type)}).catch(function(e){a(e)})})},u.src=window.URL.createObjectURL(e)})},e.prototype.isImgUsingAlpha=function(e){for(var t=0;t<e.data.length;t+=4)if(255!==e.data[t+3])return!0;return!1},e.prototype.generateResultFile=function(e,t,n,i){var r=new Blob([e],{type:n});return this.blobToFile(r,t,i)},e.prototype.blobToFile=function(e,t,n){var i=e;return i.name=t,i.lastModified=n,i},e=c([t.Injectable(),f(0,t.Inject(t.forwardRef(function(){return a})))],e)}(),s=function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},d=function(){function e(){}return e=s([t.NgModule({providers:[{provide:u,useClass:u},{provide:a,useClass:a}]})],e)}();e.Ng2PicaService=u,e.Ng2PicaModule=d,e.ImgExifService=a,Object.defineProperty(e,"__esModule",{value:!0})});